<%- include('partials/head') %>
	<body>
		<header>
			<div>
			  <a href="index.html">
				<img src="../img/logo.png" alt="Logo de Solo Caps"></a>
		
			  <h1>Solo Caps</h1>
			</div>
			<nav>
			  <a class="activo" href="index.html">Inicio</a>
			  <a href="productos.html">Productos</a>
			  <a href="accesorios.html">Accesorios</a>
			  <a href="contacto.html">Contactenos</a>
			  <a href="listado.html">Listado</a>
			</nav>
			  
		
		  </header>

		  <main>
				<h2>Modificar Concepto</h2>
				<div id="concepto-modificar">
					<form id="modificar-concepto-form">
						<input type="hidden" id="concepto-id" value="<%= concepto.id %>">
						
						<label for="nombre">Nombre:</label>
						<input type="text" id="nombre" value="<%= concepto.nombre %>">
					
						<label for="rubro">Rubro:</label>
						<input type="text" id="rubro" value="<%= concepto.rubro_id %>">
					
						<label for="tipo">Tipo:</label>
						<select id="tipo">
							<option value="ingreso" <%= concepto.tipo === 'ingreso' ? 'selected' : '' %>>Ingreso</option>
							<option value="egreso" <%= concepto.tipo === 'egreso' ? 'selected' : '' %>>Egreso</option>
						</select>
					
						<label for="requiere_vencimiento">Requiere vencimiento:</label>
						<input type="checkbox" id="requiere_vencimiento" <%= concepto.requiere_vencimiento ? 'checked' : '' %> >
					
						<button type="submit">Guardar Cambios</button>
					</form>
					<div id="btn-cancelar">
						<a href="/conceptos.html" class="btn">Cancelar</a>
					</div>
				</div>

				<script>
					document.getElementById("modificar-concepto-form").addEventListener("submit", function (event) {
						event.preventDefault();
				
						const id = document.getElementById("concepto-id").value;
						const nombre = document.getElementById("nombre").value;
						const rubro_id = document.getElementById("rubro").value;
						const tipo = document.getElementById("tipo").value;
						const requiere_vencimiento = document.getElementById("requiere_vencimiento").checked ? 1 : 0;
				
						const token = localStorage.getItem("jwt-token");
				
						fetch(`/conceptos/${id}`, {
							method: "PUT",
							headers: {
								"Authorization": `Bearer ${token}`,
								"Content-Type": "application/json"
							},
							body: JSON.stringify({ nombre, rubro_id, tipo, requiere_vencimiento })
						})
						.then(response => {
							if (!response.ok) throw new Error("Error al actualizar el concepto");
							return response.json();
						})
						.then(data => {
							alert(data.mensaje);
							window.location.href = "/conceptos";
						})
						.catch(error => console.error("Error:", error));
					});
				</script>
				
		  </main>


<%- include('partials/footer') %>